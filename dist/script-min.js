var margin={top:40,right:20,bottom:60,left:60},red="#D64541",blue="#446CB3",scoreData={2000:null,2002:null,2004:null,2006:null,2008:null,2010:null,2012:null,2014:null,2016:null};function drawCurve(t){var e=d3.select(".body").node().offsetWidth-margin.left-margin.right,a=500-margin.top-margin.bottom,r=document.getElementById("year-selecter"),s=r.options[r.selectedIndex].value,n=document.getElementById("toggle-eg-band").checked;d3.selectAll(".graph").classed("hidden",!0).classed("active",!1);var i,o,l,c,p=d3.scaleLinear().range([0,e]).domain([0,100]),u=d3.scaleLinear().range([a,0]).domain([0,100]),m=d3.select("#"+t),f=m.select(".tooltip"),g=d3.bisector(function(t){return t.votes}).right,y=m.node().dataset;m.select("svg").selectAll("*").remove(),d3.csv("./data/seats-votes/"+s+"/"+t+".csv",function(r,h){h.forEach(function(t){t.votes=parseFloat(t.votes),t.seatsR=parseFloat(t.seatsR),t.seatsD=parseFloat(t.seatsD)});var v=m.classed("hidden",!1).classed("active",!0).select("svg").attr("width",e+margin.left+margin.right).attr("height",a+margin.top+margin.bottom).on("mousemove",function(){i=d3.mouse(this),o=p.invert(i[0]-margin.left),l=g(h,o),datum=h[l],redDot=m.select(".red-dot"),blueDot=m.select(".blue-dot"),c=m.select(".tooltip-line"),0==l?(f.classed("hidden",!0),redDot.classed("hidden",!0),blueDot.classed("hidden",!0),c.classed("hidden",!0)):(redDot.attr("cx",p(datum.votes)).attr("cy",u(datum.seatsR)).classed("hidden",!1),blueDot.attr("cx",p(datum.votes)).attr("cy",u(datum.seatsD)).classed("hidden",!1),c.attr("x1",p(datum.votes)).attr("x2",p(datum.votes)).classed("hidden",!1),f.classed("hidden",!1).html("<strong>At "+datum.votes.toFixed(2)+"% of the Vote</strong>:<br>Republican Seat Share: "+datum.seatsR.toFixed(2)+"%<br>Democrat Seat Share: "+datum.seatsD.toFixed(2)+"%").style("left",(20+i[0]+f.node().offsetWidth>m.node().offsetWidth?i[0]-20-f.node().offsetWidth:i[0]+20)+"px").style("top",i[1]-30+"px"))}).on("mouseout",function(t){f.classed("hidden",!0),redDot.classed("hidden",!0),blueDot.classed("hidden",!0),c.classed("hidden",!0)}).append("g").attr("transform","translate("+margin.left+","+margin.top+")");v.append("circle").attr("class","red-dot hidden").style("fill",red).attr("r",5),v.append("circle").attr("class","blue-dot hidden").style("fill",blue).attr("r",5),v.append("line").attr("class","tooltip-line hidden").attr("x1",p(0)).attr("y1",u(0)).attr("x2",p(0)).attr("y2",u(100)).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5"),v.append("g").attr("transform","translate(0,"+a+")").call(d3.axisBottom(p).ticks(5).tickFormat(function(t){return t+"%"})),v.append("text").attr("transform","translate("+e/2+" ,"+(a+margin.top+10)+")").attr("class","axis-label").text("Percentage of Vote"),v.append("text").attr("transform","translate("+e/2+" ,-20)").attr("class","axis-label").text("Seats-Votes Curve for "+y.state+" in "+s),v.append("g").call(d3.axisLeft(u).ticks(5).tickFormat(function(t){return t+"%"})),v.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-a/2).attr("dy","1em").attr("class","axis-label").text("Percentage of Seats ("+y.districts+" seats total)");var x=d3.line().x(function(t){return p(t.votes)}).y(function(t){return u(t.seatsR)}),b=d3.line().x(function(t){return p(t.votes)}).y(function(t){return u(t.seatsD)});if(v.append("path").data([h]).style("stroke",red).attr("class","line").attr("d",x),v.append("path").data([h]).style("stroke",blue).attr("class","line").attr("d",b),v.append("line").attr("x1",function(t){return p(0)}).attr("y1",function(t){return u(50)}).attr("x2",function(t){return p(100)}).attr("y2",function(t){return u(50)}).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5"),v.append("line").attr("x1",p(50)).attr("y1",u(0)).attr("x2",p(50)).attr("y2",u(100)).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5"),n&&v.append("polyline").attr("points",p(17)+","+u(0)+" "+p(33)+","+u(0)+" "+p(83)+","+u(100)+" "+p(67)+","+u(100)).style("fill","black").style("fill-opacity","0.3"),null==scoreData[""+s])d3.csv("./data/seats-votes-scores/"+s+".csv",function(e,a){scoreData[""+s]=[],a.forEach(function(e){e.state==t&&v.append("text").attr("x",10).attr("y",10).append("svg:tspan").attr("x",10).attr("dy",0).text("Partisan bias: "+parseFloat(e.gk_bias).toFixed(2)+"%").append("svg:tspan").attr("x",10).attr("dy",20).text("Symmetry: "+parseFloat(e.symmetry).toFixed(2)+"%").append("svg:tspan").attr("x",10).attr("dy",20).text("Responsiveness: "+parseFloat(e.responsiveness).toFixed(2)+"%"),scoreData[""+s].push({state:e.state,gk_bias:parseFloat(e.gk_bias).toFixed(2),symmetry:parseFloat(e.symmetry).toFixed(2),responsiveness:parseFloat(e.responsiveness).toFixed(2)})})});else for(var k=0;k<scoreData[""+s].length;k++)if(d=scoreData[""+s][k],d.state==t){v.append("text").attr("x",10).attr("y",10).append("svg:tspan").attr("x",10).attr("dy",0).text("Partisan bias: "+d.gk_bias+"%").append("svg:tspan").attr("x",10).attr("dy",20).text("Symmetry: "+d.symmetry+"%").append("svg:tspan").attr("x",10).attr("dy",20).text("Responsiveness: "+d.responsiveness+"%");break}})}margin={top:40,right:20,bottom:60,left:60},red="#D64541",blue="#446CB3";function drawDemonstrationCurve(t){var e,a,r=d3.select("#"+t).node().dataset;r.half?(e=(d3.select(".section").node().offsetWidth-100)/2-margin.left-margin.right,a=d3.select("table").node().offsetHeight-margin.top-margin.bottom):(e=d3.select(".section").node().offsetWidth-100-margin.left-margin.right,a=400-margin.top-margin.bottom),r.height&&(a=parseInt(r.height)-margin.top-margin.bottom);var s=d3.scaleLinear().range([0,e]).domain([0,100]),n=d3.scaleLinear().range([a,0]).domain([0,100]);d3.select("#"+t).select(".tooltip");d3.select("#"+t).select("svg").selectAll("*").remove();var i=d3.select("#"+t).classed("hidden",!1).select("svg").attr("width",e+margin.left+margin.right).attr("height",a+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");i.append("g").attr("transform","translate(0,"+a+")").call(d3.axisBottom(s).ticks(5).tickFormat(function(t){return t+"%"})),i.append("text").attr("transform","translate("+e/2+" ,"+(a+margin.top+10)+")").attr("class","axis-label").text("Percentage of Vote"),i.append("text").attr("transform","translate("+e/2+" ,-20)").attr("class","axis-label").text(r.caption?r.caption:"Seats-Votes Curve"),i.append("g").call(d3.axisLeft(n).ticks(5).tickFormat(function(t){return t+"%"})),i.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-a/2).attr("dy","1em").attr("class","axis-label").text("Percentage of Seats"),d3.csv("./data/demo/"+t+".csv",function(t,e){if(e.forEach(function(t){t.votes=parseFloat(t.votes),t.seatsR=parseFloat(t.seatsR),t.seatsD=parseFloat(t.seatsD)}),r.dots)i.selectAll(".dot-rep").data(e).enter().append("circle").attr("class","dot-rep").style("fill",red).attr("cx",function(t){return s(t.votes)}).attr("cy",function(t){return n(t.seatsR)}).attr("r",5),i.selectAll(".dot-dem").data(e).enter().append("circle").attr("class","dot-dem").style("fill",blue).attr("cx",function(t){return s(t.votes)}).attr("cy",function(t){return n(t.seatsD)}).attr("r",5);else{var a=d3.line().x(function(t){return s(t.votes)}).y(function(t){return n(t.seatsR)}),o=d3.line().x(function(t){return s(t.votes)}).y(function(t){return n(t.seatsD)});i.append("path").data([e]).style("stroke",red).attr("class","line").attr("d",a),i.append("path").data([e]).style("stroke",blue).attr("class","line").attr("d",o)}i.append("line").attr("x1",function(t){return s(0)}).attr("y1",function(t){return n(50)}).attr("x2",function(t){return s(100)}).attr("y2",function(t){return n(50)}).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5"),i.append("line").attr("x1",s(50)).attr("y1",n(0)).attr("x2",s(50)).attr("y2",n(100)).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5")})}var resizeId;margin={top:40,right:20,bottom:60,left:60};function drawHistoricalCurve(t){var e=t.split("-")[1],a=t.split("-")[2],r=d3.select("#"+t),s=r.select(".tooltip"),n=r.node().dataset,i=d3.select(".body").node().offsetWidth-margin.left-margin.right,o=500-margin.top-margin.bottom;d3.selectAll(".graph-historical-"+e).classed("hidden",!0).classed("active-historical",!1);var l,d,c,p,u=n.responsiveness?[0,10]:[-50,50],m=d3.scalePoint().range([0,i]),f=d3.scaleLinear().range([o,0]).domain(u);r.select("svg").selectAll("*").remove(),d3.csv("./data/historical-results/"+e+"/"+a+".csv",function(t,e){e.forEach(function(t){t.y=parseFloat(t.y)}),m.domain(e.map(function(t){return t.year})),m.invert=d3.scaleQuantize().domain(m.range()).range(m.domain());var a=r.classed("hidden",!1).classed("active-historical",!0).select("svg").attr("width",i+margin.left+margin.right).attr("height",o+margin.top+margin.bottom).on("mousemove",function(t){var a;for(c=d3.mouse(this),p=m.invert(c[0]-margin.left),index=0,index=0;index<e.length;index++)if(e[index].year==p){a=e[index];break}l=r.select(".dot"),d=r.select(".tooltip-line"),l.attr("cx",m(a.year)).attr("cy",f(a.y)).classed("hidden",!1),d.attr("x1",m(a.year)).attr("x2",m(a.year)).classed("hidden",!1),s.classed("hidden",!1).html("<strong>In "+a.year+"</strong>:<br>"+n.title+": "+a.y.toFixed(2)+"%").style("left",(20+c[0]+s.node().offsetWidth>r.node().offsetWidth?c[0]-20-s.node().offsetWidth:c[0]+20)+"px").style("top",c[1]-30+"px")}).on("mouseout",function(t){s.classed("hidden",!0),l.classed("hidden",!0),d.classed("hidden",!0)}).append("g").attr("transform","translate("+margin.left+","+margin.top+")");a.append("circle").attr("class","dot hidden").style("fill","black").attr("r",5),a.append("line").attr("class","tooltip-line hidden").attr("x1",m(0)).attr("y1",f(u[0])).attr("x2",m(0)).attr("y2",f(u[1])).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5"),a.append("g").attr("transform","translate(0,"+o+")").call(d3.axisBottom(m)),a.append("text").attr("transform","translate("+i/2+" ,"+(o+margin.top+10)+")").attr("class","axis-label").text("Year"),a.append("text").attr("transform","translate("+i/2+" ,-20)").attr("class","axis-label").text(n.title+" in "+n.state+" between 2000 - 2016"),a.append("g").call(d3.axisLeft(f).ticks(5).tickFormat(function(t){return t+"%"})),a.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-o/2).attr("dy","1em").attr("class","axis-label").text(n.title);var g=d3.line().x(function(t){return m(t.year)}).y(function(t){return f(t.y)});a.append("path").data([e]).style("stroke","#2c3e50").attr("class","line").attr("d",g),a.append("line").attr("x1",function(t){return m("2000")}).attr("y1",function(t){return f(0)}).attr("x2",function(t){return m("2016")}).attr("y2",function(t){return f(0)}).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5")})}function drawFigures(){drawDemonstrationCurve("step-1"),drawDemonstrationCurve("step-2"),drawDemonstrationCurve("step-3"),drawDemonstrationCurve("step-4"),drawDemonstrationCurve("not-symmetric"),drawDemonstrationCurve("symmetric"),drawDemonstrationCurve("proportional"),drawDemonstrationCurve("incumbent-protection"),drawDemonstrationCurve("winner-take-all"),drawDemonstrationCurve("eg-optimized"),drawDemonstrationCurve("partisan-bias"),drawDemonstrationCurve("partisan-not-bias")}function redrawCurves(){drawCurve(d3.select(".active").attr("id")),drawHistoricalCurve(d3.select(".graph-historical-gk.active-historical").attr("id")),drawHistoricalCurve(d3.select(".graph-historical-symmetry.active-historical").attr("id")),drawHistoricalCurve(d3.select(".graph-historical-responsiveness.active-historical").attr("id"))}drawCurve("AL"),drawHistoricalCurve("historical-gk-us"),drawHistoricalCurve("historical-responsiveness-us"),drawHistoricalCurve("historical-symmetry-us"),drawFigures(),d3.select(window).on("resize",function(){resizeId=setTimeout(function(){drawFigures(),redrawCurves()},500)});